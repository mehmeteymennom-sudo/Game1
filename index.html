<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mini Minecraft HTML - Kamera Yönlü</title>
<style>
    body { margin:0; overflow:hidden; background:#000; }
    #info {
        position:absolute; top:10px; left:10px;
        color:white; font-family:monospace; font-size:14px;
        background:rgba(0,0,0,0.5); padding:8px; border-radius:6px;
    }
    #crosshair {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 20px;
        height: 20px;
        pointer-events: none;
        transform: translate(-50%, -50%);
    }
    #crosshair:before, #crosshair:after {
        content: '';
        position: absolute;
        background: white;
    }
    #crosshair:before { left: 50%; top: 0; width: 2px; height: 100%; transform: translateX(-50%); }
    #crosshair:after { top: 50%; left: 0; width: 100%; height: 2px; transform: translateY(-50%); }
</style>
</head>
<body>
<div id="info">Kontroller:<br>
WASD = 2 4 8 6<br>
Zıpla = 5<br>
Kamera: 1(sol) 3(sağ) 7(yukarı) 9(aşağı)<br>
0 = Sonraki blok • * = Koy • # = Kır
</div>
<div id="crosshair"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.157/build/three.min.js"></script>
<script>
// ---- Sahne ----
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87CEEB);

const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
camera.position.set(0, 2, 5);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

// ---- Ekran boyutuna uyum ----
window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});

// ---- Işık ----
const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(1,1,1).normalize();
scene.add(light);

// ---- Bloklar ----
const blockTypes = [
    new THREE.MeshLambertMaterial({color:0x0000ff}),
    new THREE.MeshLambertMaterial({color:0xaaaaaa}),
    new THREE.MeshLambertMaterial({color:0x8B4513})
];
let currentBlock = 0;

const world = [];
function addBlock(x,y,z, typeOrMaterial){
    const geo = new THREE.BoxGeometry(1,1,1);
    const mat = (typeOrMaterial instanceof THREE.Material) ? typeOrMaterial : blockTypes[typeOrMaterial];
    const cube = new THREE.Mesh(geo, mat);
    cube.position.set(x,y,z);
    scene.add(cube);
    world.push(cube);
}

// ---- Düz dünya ----
const WORLD_SIZE = 40;
const groundMaterial = new THREE.MeshLambertMaterial({color:0x00aa00});
for(let x=-WORLD_SIZE; x<WORLD_SIZE; x++){
    for(let z=-WORLD_SIZE; z<WORLD_SIZE; z++){
        addBlock(x,0,z, groundMaterial);
    }
}

// ---- Oyuncu ----
const START_POS = {x:0, y:2, z:0};
const player = {x: START_POS.x, y: START_POS.y, z: START_POS.z, yaw:0, pitch:0, vy:0, width:0.6, height:1.8};
function updateCamera(){
    camera.position.set(player.x, player.y, player.z);
    camera.rotation.order = "YXZ";
    camera.rotation.y = player.yaw;
    camera.rotation.x = player.pitch;
}

// ---- Blok koy/kır ----
function placeBlock(){
    const dir = new THREE.Vector3(0,0,-1).applyEuler(camera.rotation);
    const px = Math.round(player.x + dir.x*2);
    const py = Math.round(player.y + dir.y*2);
    const pz = Math.round(player.z + dir.z*2);
    addBlock(px,py,pz,currentBlock);
}
function breakBlock(){
    const dir = new THREE.Vector3(0,0,-1).applyEuler(camera.rotation);
    const px = Math.round(player.x + dir.x*2);
    const py = Math.round(player.y + dir.y*2);
    const pz = Math.round(player.z + dir.z*2);
    for(let b of world){
        if(Math.round(b.position.x)==px && Math.round(b.position.y)==py && Math.round(b.position.z)==pz){
            scene.remove(b);
            world.splice(world.indexOf(b),1);
            break;
        }
    }
}

// ---- Çarpışma ----
function checkCollision(nx,ny,nz){
    for(let b of world){
        if(Math.abs(nx-b.position.x)<0.5+player.width/2 &&
           Math.abs(ny-b.position.y)<0.5+player.height/2 &&
           Math.abs(nz-b.position.z)<0.5+player.width/2) return true;
    }
    return false;
}

// ---- Hareket ----
function tryMove(dx,dy,dz){
    const nx = player.x + dx;
    const ny = player.y + dy;
    const nz = player.z + dz;

    if(!checkCollision(nx,ny,nz)) player.x = nx, player.y = ny, player.z = nz;
    else if(dy<0) player.vy=0;

    if(player.x < -WORLD_SIZE+0.5) player.x = -WORLD_SIZE+0.5;
    if(player.x > WORLD_SIZE-1.5) player.x = WORLD_SIZE-1.5;
    if(player.z < -WORLD_SIZE+0.5) player.z = -WORLD_SIZE+0.5;
    if(player.z > WORLD_SIZE-1.5) player.z = WORLD_SIZE-1.5;

    updateCamera();
}

function tryMoveCam(forward, right){
    const dir = new THREE.Vector3();
    camera.getWorldDirection(dir);
    dir.y = 0;
    dir.normalize();

    const rightDir = new THREE.Vector3();
    rightDir.crossVectors(dir, new THREE.Vector3(0,1,0)).normalize();

    const dx = dir.x*forward + rightDir.x*right;
    const dz = dir.z*forward + rightDir.z*right;

    tryMove(dx,0,dz);
}

// ---- Kontroller ----
document.addEventListener("keydown", e=>{
    switch(e.key){
        case "2": tryMoveCam(1,0); break;
        case "8": tryMoveCam(-1,0); break;
        case "4": tryMoveCam(0,-1); break;
        case "6": tryMoveCam(0,1); break;
        case "5": if(player.vy==0) player.vy = 0.2; break;

        case "1": player.yaw += 0.1; updateCamera(); break;
        case "3": player.yaw -= 0.1; updateCamera(); break;
        case "7": player.pitch += 0.1; updateCamera(); break;
        case "9": player.pitch -= 0.1; updateCamera(); break;

        case "0": currentBlock = (currentBlock+1)%blockTypes.length; break;
        case "*": placeBlock(); break;
        case "#": breakBlock(); break;
    }
});

// ---- Yerçekimi ----
function applyGravity(){
    player.vy -= 0.01;
    tryMove(0, player.vy, 0);
}

// ---- Bug kontrolü ----
function checkOutOfBounds(){
    if(player.y < -10 || player.y > 1000){
        player.x = START_POS.x; player.y = START_POS.y; player.z = START_POS.z; player.vy = 0;
        updateCamera();
    }
}

// ---- Döngü ----
function animate(){
    requestAnimationFrame(animate);
    applyGravity();
    checkOutOfBounds();
    renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
